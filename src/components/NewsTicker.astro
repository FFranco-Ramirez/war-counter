---
// Fetch BBC News RSS Feed (Europe Section)
const RSS_URL = 'http://feeds.bbci.co.uk/news/world/europe/rss.xml';

let newsItems = [];
let error = null;

try {
  const response = await fetch(RSS_URL);
  if (!response.ok) throw new Error('Failed to fetch RSS');
  const xml = await response.text();

  // Simple regex to extract titles from items
  // This avoids adding heavy XML parser dependencies
  const itemRegex = /<item>([\s\S]*?)<\/item>/g;
  const titleRegex = /<title><!\[CDATA\[(.*?)\]\]><\/title>|<title>(.*?)<\/title>/;
  
  let match;
  while ((match = itemRegex.exec(xml)) !== null) {
    const itemContent = match[1];
    const titleMatch = titleRegex.exec(itemContent);
    if (titleMatch) {
      const title = titleMatch[1] || titleMatch[2];
      // Filter for relevant keywords
      if (/Ukraine|Russia|Putin|Zelensky|Kyiv|Moscow|War|Conflict|Missile|Drone/i.test(title)) {
        newsItems.push(title);
      }
    }
  }
  
  // Fallback if no specific news found (show top 5 general Europe news)
  if (newsItems.length === 0) {
     let count = 0;
     // Reset regex
     itemRegex.lastIndex = 0;
     while ((match = itemRegex.exec(xml)) !== null && count < 5) {
        const itemContent = match[1];
        const titleMatch = titleRegex.exec(itemContent);
        if (titleMatch) {
            newsItems.push(titleMatch[1] || titleMatch[2]);
            count++;
        }
     }
  }

} catch (e) {
  console.error("Error fetching news:", e);
  error = "Unable to load latest news updates.";
  newsItems.push("Monitoring situation...");
}
---

<div class="w-full bg-black/40 border-y border-slate-800 backdrop-blur-md py-4 overflow-hidden relative mt-8">
    <div class="absolute left-0 top-0 bottom-0 w-20 bg-gradient-to-r from-[#020617] to-transparent z-10"></div>
    <div class="absolute right-0 top-0 bottom-0 w-20 bg-gradient-to-l from-[#020617] to-transparent z-10"></div>
    
    <div class="flex items-center gap-4 animate-marquee whitespace-nowrap">
        <span class="text-red-500 font-bold text-xs tracking-widest px-4 border-r border-slate-700 flex-shrink-0">LATEST UPDATES</span>
        
        {newsItems.map((item) => (
            <span class="text-slate-300 text-sm font-light tracking-wide flex items-center">
                {item}
                <span class="mx-6 text-slate-700 text-[10px]">•</span>
            </span>
        ))}
        
        <!-- Duplicate for seamless loop -->
        {newsItems.map((item) => (
            <span class="text-slate-300 text-sm font-light tracking-wide flex items-center">
                {item}
                <span class="mx-6 text-slate-700 text-[10px]">•</span>
            </span>
        ))}
    </div>
</div>

<style>
    .animate-marquee {
        animation: marquee 40s linear infinite;
    }
    @keyframes marquee {
        0% { transform: translateX(0); }
        100% { transform: translateX(-50%); }
    }
    
    /* Pause on hover for readability */
    .animate-marquee:hover {
        animation-play-state: paused;
    }
</style>
